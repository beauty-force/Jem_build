import{o as r,c as l,d as s,H as A,L as z,G as b,r as d,b as c,w as x,F as v,n as f,I as _,f as U,i as m,t as g,e as D}from"./app.409a8e5d.js";import{U as M}from"./UserLayout.da06f601.js";import{V as H,r as V,a as j}from"./vue-draggable-next.esm-bundler.25e849f6.js";import{_ as B}from"./_plugin-vue_export-helper.cdc0426e.js";import"./Category.b7f81081.js";function F(e,t){return r(),l("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true"},[s("path",{d:"M3.478 2.405a.75.75 0 00-.926.94l2.432 7.905H13.5a.75.75 0 010 1.5H4.984l-2.432 7.905a.75.75 0 00.926.94 60.519 60.519 0 0018.445-8.986.75.75 0 000-1.218A60.517 60.517 0 003.478 2.405z"})])}const N={components:{Head:A,UserLayout:M,Link:z,draggable:H,ArrowLongUpIcon:V,ArrowLongDownIcon:j,PaperAirplaneIcon:F},props:{errors:Object,auth:Object,gachas:Object,category_share:Object,shuffle_mode:Boolean},data(){return{enabled:!0,list:this.gachas.data.map(e=>({...e,fixed:e.order_level>1e6})),dragging:!1}},methods:{log(e){this.refresh_list()},refresh_list(){this.list=[...this.list.filter(e=>e.fixed),...this.list.filter(e=>!e.fixed)],this.$nextTick(()=>{this.initializeLazyLoading()})},levelUp(e){let t;for(t=1;t<this.list.length&&this.list[t].id!=e;t++);t<this.list.length&&this.arrayMove(t,t-1),this.refresh_list()},arrayMove(e,t){this.list.splice(t,0,this.list.splice(e,1)[0]),this.refresh_list()},levelDown(e){let t;for(t=0;t<this.list.length-1&&this.list[t].id!=e;t++);t<this.list.length-1&&this.arrayMove(t,t+1),this.refresh_list()},submit(){this.form.gachas=this.list,this.form.post(route("admin.gacha.sorting.store"),{onFinish:()=>{}})},shuffle(){this.list=this.list.map(e=>({value:e,sort:Math.random()})).sort((e,t)=>e.sort-t.sort).map(({value:e})=>e),this.refresh_list()},toggle_shuffle(e){this.form_shuffle_mode.shuffle_mode=e,this.form_shuffle_mode.post(route("admin.gacha.shuffle_mode"),{onFinish:()=>{}})},toggle_fix(e){let t;for(t=0;t<this.list.length;t++)if(this.list[t].id==e){this.list[t].fixed^=!0;break}this.refresh_list()},initializeLazyLoading(){const e=document.querySelectorAll("img._lazy"),t={root:null,rootMargin:"0px",threshold:.1},h=i=>{i.src=i.dataset.src},a=new IntersectionObserver((i,n)=>{i.forEach(u=>{u.isIntersecting&&(h(u.target),n.unobserve(u.target))})},t);e.forEach(i=>{a.observe(i)})}},setup(e){const t=b({gachas:[]}),h=b({shuffle_mode:e.shuffle_mode});return{form:t,form_shuffle_mode:h}},mounted(){this.initializeLazyLoading()}},O={class:"mt-2 px-1.5 md:px-3"},S={class:"p-1 justify-end flex gap-2 items-center"},E=["disabled"],P=["disabled"],T=["disabled"],q={class:"inline-block align-middle"},G=s("div",{class:"inline-block align-middle"},"\u4FDD\u5B58\u3059\u308B",-1),J={class:"flex mb-1"},K=["data-src"],Q={class:"inline-block text-left align-middle"},R={key:0,class:"bg-green-600 rounded text-xs px-2 mx-1"},W={key:1,class:"bg-neutral-600 rounded text-xs px-2 mx-1"},X=s("span",{class:"text-white text-sm"},"\u6B8B ",-1),Y={class:"text-base"},Z={class:"text-white text-xs"},$={key:0,class:"bg-red-600 rounded text-xs px-2 mx-1"},tt=s("span",{class:"text-sm"},"1\u56DE:",-1),et={class:"align-middle h-full absolute top-0 right-2 flex items-center gap-2"},st=["onClick"],ot=["onClick"],it=["onClick"];function nt(e,t,h,a,i,n){const u=d("Head"),w=d("PaperAirplaneIcon"),k=d("ArrowLongUpIcon"),y=d("ArrowLongDownIcon"),L=d("draggable"),C=d("UserLayout");return r(),l(v,null,[c(u,{title:"\u30AC\u30C1\u30E3\u4E26\u3073\u66FF\u3048"}),c(C,null,{default:x(()=>[s("div",O,[s("div",S,[h.shuffle_mode?(r(),l("button",{key:1,type:"button",onClick:t[1]||(t[1]=o=>n.toggle_shuffle(0)),class:f([{"opacity-25":a.form_shuffle_mode.processing},"inline px-10 py-2.5 bg-neutral-500 border border-transparent rounded-md font-semibold text-xs text-white tracking-widest hover:bg-neutral-700 active:bg-neutral-700 focus:outline-none focus:border-neutral-700 focus:shadow-outline-neutral transition ease-in-out duration-150 mr-2"]),disabled:a.form_shuffle_mode.processing}," \u30E9\u30F3\u30C0\u30E0\u8A2D\u5B9A\u89E3\u9664 ",10,P)):(r(),l("button",{key:0,type:"button",onClick:t[0]||(t[0]=o=>n.toggle_shuffle(1)),class:f([{"opacity-25":a.form_shuffle_mode.processing},"inline px-10 py-2.5 bg-green-500 border border-transparent rounded-md font-semibold text-xs text-white tracking-widest hover:bg-green-700 active:bg-green-700 focus:outline-none focus:border-green-700 focus:shadow-outline-green transition ease-in-out duration-150 mr-2"]),disabled:a.form_shuffle_mode.processing}," \u30E9\u30F3\u30C0\u30E0\u8A2D\u5B9A ",10,E)),s("button",{onClick:t[2]||(t[2]=_(o=>n.submit(),["prevent"])),class:f([{"opacity-25":a.form.processing},"w-32 bg-cyan-600 hover:bg-cyan-700 text-white text-sm font-normal py-2 px-3 inline-block rounded"]),disabled:a.form.processing},[s("div",q,[c(w,{class:"w-5 h-5 mr-1"})]),G],10,T)]),s("div",J,[c(L,{class:"dragArea list-group w-full",list:i.list,onChange:n.log},{default:x(()=>[(r(!0),l(v,null,U(i.list,(o,I)=>(r(),l("div",{class:"list-group-item bg-neutral-800 m-1 p-1 rounded-md text-left cursor-pointer text-white relative",key:I},[s("img",{"data-src":o.thumbnail,class:"w-24 h-24 inline-block align-middle mr-2 _lazy"},null,8,K),s("div",Q,[s("div",null,[o.status==1?(r(),l("span",R,"\u516C\u958B")):m("",!0),o.status==0?(r(),l("span",W,"\u975E\u516C\u958B")):m("",!0)]),s("div",null,[X,s("span",Y,g(o.count_rest),1),s("span",Z,"/"+g(o.count_card),1),o.count_rest==0?(r(),l("span",$,"Soldout")):m("",!0)]),s("div",null,[tt,D(),s("span",null,g(o.point)+" pt",1)])]),s("div",et,[s("button",{onClick:p=>n.toggle_fix(o.id),class:f(["rounded px-2 py-1 text-sm",{"bg-neutral-700 text-white":!o.fixed,"bg-neutral-100 text-rose-500":o.fixed}])},g(o.fixed?"\u9806\u5E8F\u56FA\u5B9A":"\u56FA\u5B9A\u89E3\u9664"),11,st),s("button",{onClick:_(p=>n.levelUp(o.id),["prevent"]),class:"bg-neutral-700 rounded p-1 hover:bg-neutral-600"},[c(k,{class:"w-6 h-5 text-white block"})],8,ot),s("button",{onClick:_(p=>n.levelDown(o.id),["prevent"]),class:"bg-neutral-700 rounded p-1 hover:bg-neutral-600"},[c(y,{class:"w-6 h-5 text-white block"})],8,it)])]))),128))]),_:1},8,["list","onChange"])])])]),_:1})],64)}const ht=B(N,[["render",nt]]);export{ht as default};
